<!DOCTYPE html>
<html>

<head>
  <title>Wheels of Fortune</title>
  <script src="jsPsych/jspsych.js"></script>
  <script src="jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych/plugins/jspsych-html-button-response.js"></script>
  <script src="jsPsych/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="jsPsych/plugins/jspsych-wof-choose-spin.js"></script>
  <script src="jsPsych/plugins/jspsych-wof-slider-response.js"></script>
  <script src="jsPsych/snap.svg.js"></script>
  <script src="PapaParse/papaparse.js"></script>
  <script src="trial_list.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="jsPsych/css/jspsych.css">
  <link rel="stylesheet" href="jsPsych/css/extra.css">
</head>

<body></body>
<script>
  /* create timeline */
  var timeline = [];

  // arrow code
  var arrow = ['<svg id="arrow0" height = "300px" width = "300px" style="position: absolute; top:0; left:0;"></svg>',
              '<svg id="arrow1" height = "300px" width = "300px" style="position: absolute; top:0; left:0;"></svg>']

  // variable to hold button pressed on each trial
  var button_pressed

  /* define welcome message trial */
  var welcome_block = {
    type: "html-keyboard-response",
    stimulus: "Welcome to the experiment. Press any key to begin."
  };
  //timeline.push(welcome_block);

  /* define instructions trial */
  var instructions = {
    type: "html-keyboard-response",
    stimulus: "<p>Instructions go here.</p>",
    post_trial_gap: 500
  };
  //timeline.push(instructions);

  // Example trial variables

  var trial = {
    type: 'wof-choose-spin',
    trial_type: jsPsych.timelineVariable('trial_type'),
    left_value_1: jsPsych.timelineVariable('left_value_1'),
    left_value_2: jsPsych.timelineVariable('left_value_2'),
    left_prob_1: jsPsych.timelineVariable('left_prob_1'),
    left_outcome: jsPsych.timelineVariable('left_outcome'),
    trial_type: jsPsych.timelineVariable('trial_type'),
    right_value_1: jsPsych.timelineVariable('right_value_1'),
    right_value_2: jsPsych.timelineVariable('right_value_2'),
    right_prob_1: jsPsych.timelineVariable('right_prob_1'),
    right_outcome: jsPsych.timelineVariable('right_outcome'),
    post_trial_gap: 1000
  }

  var slider = {
    type: 'wof-slider-response',
    labels: ['very sad', 'very happy']
  }



  var choice = {
    type: 'html-keyboard-response',
    stimulus: function() {
      return '<div><br>' +
                '<div style="display: inline-block; margin: 0px 6px; border:2px solid '+['black','white'][button_pressed]+';">' +
                  '<div class="pie-yum" style="position: relative;">' +
                    '<svg class="pie" id="spinner0" width="300px" height="300px" viewBox="0 0 32 32">' +
                    '<circle r="16" cx="16" cy="16" fill="blue" stroke="yellow" stroke-width="32" stroke-dasharray="' + jsPsych.timelineVariable('prop_a1', true) * 100 + ' 100" />' +
                  '</div>' +
                '</div>' +
                '<div style="display: inline-block; margin: 0px 6px; border:2px solid '+['white','black'][button_pressed]+'";>' +
                  '<div class="pie-yum" style="position: relative;">' +
                    '<svg class="pie" id="spinner1" width="300px" height="300px" viewBox="0 0 32 32">' +
                    '<circle r="16" cx="16" cy="16" fill="blue" stroke="yellow" stroke-width="32" stroke-dasharray="' + jsPsych.timelineVariable('prop_b1', true) * 100 + ' 100" />' +
                  '</div>' +
                '</div>' +
              '</div>'
    },
    choices: jsPsych.NO_KEYS,
    trial_duration: 600
  }

  var spin = {
    type: 'html-keyboard-response',
    stimulus: function() {
        return '<div><br>' +
                  '<div style="display: inline-block; margin: 0px 6px; border:2px solid '+['black','white'][button_pressed]+';">' +
                    '<div class="pie-yum" style="position: relative;">' +
                      '<svg class="pie" id="spinner0" width="300px" height="300px" viewBox="0 0 32 32">' +
                      '<circle r="16" cx="16" cy="16" fill="blue" stroke="yellow" stroke-width="32" stroke-dasharray="' + jsPsych.timelineVariable('prop_a1', true) * 100 + ' 100" />' +
                    '</div>' +
                  '</div>' +
                  '<div style="display: inline-block; margin: 0px 6px; border:2px solid '+['white','black'][button_pressed]+'";>' +
                    '<div class="pie-yum" style="position: relative;">' +
                      '<svg class="pie" id="spinner1" width="300px" height="300px" viewBox="0 0 32 32">' +
                      '<circle r="16" cx="16" cy="16" fill="blue" stroke="yellow" stroke-width="32" stroke-dasharray="' + jsPsych.timelineVariable('prop_b1', true) * 100 + ' 100" />' +
                    '</div>' +
                  '</div>' +
                '</div>'
    },
    on_load: function() {
      document.getElementsByClassName('pie-yum')[button_pressed].innerHTML += arrow;
      // draw the arrow using snap.svg
      var s = Snap("#arrow");
      var c = s.circle(150, 150, 5);
      var g = s.group(s.line(150, 50, 150, 150).attr({stroke: "#000", strokeWidth: 2}),
                      s.polyline([150, 50, 140, 60, 160, 60]))
      // random rotation value
      var rotate = Math.random() * 360;

      // calculate outcome (is rotation value greater than pie slice?)
      // var result = ["insect", "not insect"][+(rotate > (button_probs[button_pressed]*360))]
      // animate the rotation and display the outcome
      g.animate({ transform: 'r'+(360+rotate)+',150,150'}, 1000, mina.easeinout)
    },
    choices: jsPsych.NO_KEYS,
    trial_duration: 5000
  }


  var test_procedure = {
    timeline: [trial, slider],
    timeline_variables: trial_list,
    randomize_order: true
  }
  timeline.push(test_procedure);


  /* start the experiment */
  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      jsPsych.data.displayData();
    }
  });
</script>

</html>
